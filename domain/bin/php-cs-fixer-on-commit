#!/usr/bin/env bash

CURRENT_DIRECTORY=`pwd`
BIN_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

DOMAIN_DIRECTORY="$BIN_DIR/.."


cd $DOMAIN_DIRECTORY;
PHP_CS_FIXER="vendor/bin/php-cs-fixer"

HAS_PHP_CS_FIXER=false

if [ -x "$PHP_CS_FIXER" ]; then
    HAS_PHP_CS_FIXER=true
fi

if $HAS_PHP_CS_FIXER; then
    git --git-dir ../.git --work-tree .. status --porcelain | grep -e '.* domain/.*\.php$' | cut -c 11- | while read line; do
        ${PHP_CS_FIXER} fix ${line};
        git --git-dir ../.git --work-tree .. add "$line";
    done
else
    echo ""
    echo "Please install php-cs-fixer dependence"
    echo "  cd domain && composer install"
    echo ""
fi

cd $CURRENT_DIRECTORY;
